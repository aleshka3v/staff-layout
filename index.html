<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Расстановка персонала | Lamoda TS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --lamoda-red: #E31E24;
            --lamoda-black: #000000;
            --lamoda-white: #FFFFFF;
            --lamoda-light-gray: #F5F5F5;
            --lamoda-dark-gray: #333333;
        }

        * {
            box-sizing: border-box;
            transition: all 0.2s ease;
        }

        body {
            font-family: 'Segoe UI', Roboto, -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--lamoda-light-gray);
            color: var(--lamoda-black);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        body::after {
            content: "LAMODA";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 40vw;
            font-weight: 900;
            color: rgba(227, 30, 36, 0.05);
            z-index: -1;
            pointer-events: none;
            user-select: none;
        }

        /* Header */
        .header {
            background-color: var(--lamoda-black);
            color: var(--lamoda-white);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h2 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .total-counter {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 12px;
            margin-right: 8px;
            white-space: nowrap;
        }

        button {
            background-color: var(--lamoda-red);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        button:hover {
            background-color: #C11A20;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Main layout */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 15px;
            padding: 15px;
        }

        /* Left panel - sections */
        .sections-panel {
            flex: 0 0 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .section-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .section-header {
            background-color: var(--lamoda-black);
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-counter {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .section-content {
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Right panel - staff */
        .staff-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow: hidden;
        }

        .staff-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .staff-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 500;
            transition: all 0.2s;
        }

        .staff-tab.active {
            border-bottom-color: var(--lamoda-red);
            color: var(--lamoda-red);
        }

        .staff-tab:hover:not(.active) {
            background-color: rgba(227, 30, 36, 0.1);
        }

        .staff-content {
            flex: 1;
            overflow-y: auto;
            display: none;
        }

        .staff-content.active {
            display: block;
        }

        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            padding: 5px;
        }

        /* Employee card */
        .employee-card {
            background-color: white;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: move;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .employee-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--lamoda-red);
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--lamoda-light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            color: var(--lamoda-red);
            font-weight: bold;
        }

        .employee-name {
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .employee-status {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ccc;
        }

        .employee-status.available {
            background-color: #4CAF50;
        }

        /* Dropzone styles */
        .dropzone.highlight {
            background-color: rgba(227, 30, 36, 0.05);
            outline: 2px dashed var(--lamoda-red);
            outline-offset: -2px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--lamoda-red);
            box-shadow: 0 0 0 2px rgba(227, 30, 36, 0.2);
        }

        /* Archive items */
        .archive-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .archive-item:last-child {
            border-bottom: none;
        }

        .archive-info {
            flex: 1;
        }

        .archive-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .archive-date {
            font-size: 12px;
            color: #777;
        }

        .archive-actions {
            display: flex;
            gap: 8px;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--lamoda-black);
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast i {
            font-size: 18px;
        }

        .toast-error {
            background-color: #d32f2f;
        }

        .toast-info {
            background-color: #1976d2;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Mobile adaptation */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sections-panel {
                flex: 0 0 auto;
                max-height: 300px;
            }
            
            .staff-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .header-controls {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: var(--lamoda-black);
                padding: 15px;
                flex-direction: column;
                gap: 10px;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
                z-index: 99;
            }
            
            .header-controls.active {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .staff-tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="mobile-menu-btn"><i class="fas fa-bars"></i></button>
        <h2><i class="fas fa-users-cog"></i> Расстановка персонала | Lamoda TS</h2>
        <div class="header-controls">
            <span class="total-counter"><i class="fas fa-user-check"></i> <span id="totalAssignedCounter">0</span>/<span id="totalAvailableCounter">0</span></span>
            <button id="archiveBtn"><i class="fas fa-archive"></i> Архив</button>
            <button id="exportBtn"><i class="fas fa-file-excel"></i> Экспорт</button>
            <button id="saveBtn"><i class="fas fa-save"></i> Сохранить</button>
            <button id="resetBtn"><i class="fas fa-redo"></i> Сбросить</button>
        </div>
    </div>
    
    <div class="main-container">
        <!-- Left panel - sections -->
        <div class="sections-panel" id="sectionsPanel">
            <!-- Sections will be added dynamically -->
        </div>
        
        <!-- Right panel - staff -->
        <div class="staff-panel">
            <div class="staff-tabs">
                <div class="staff-tab active" data-tab="available">Доступные</div>
                <div class="staff-tab" data-tab="vacation">Отпуск</div>
                <div class="staff-tab" data-tab="sickLeave">Больничный</div>
                <div class="staff-tab" data-tab="dayOff">Отгул</div>
            </div>
            
            <div class="staff-content active" id="availableStaff">
                <div class="staff-grid"></div>
            </div>
            
            <div class="staff-content" id="vacationStaff">
                <div class="staff-grid"></div>
            </div>
            
            <div class="staff-content" id="sickLeaveStaff">
                <div class="staff-grid"></div>
            </div>
            
            <div class="staff-content" id="dayOffStaff">
                <div class="staff-grid"></div>
            </div>
        </div>
    </div>
    
    <!-- Archive modal -->
    <div id="archiveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-archive"></i> Архив смен</h3>
                <button id="closeArchiveBtn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="archiveList"></div>
        </div>
    </div>
    
    <!-- Save modal -->
    <div id="saveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-save"></i> Сохранение смены</h3>
            </div>
            <div class="modal-body">
                <p>Введите название смены:</p>
                <input type="text" id="shiftName" placeholder="Например: Утренняя смена 27.07">
            </div>
            <div class="modal-footer">
                <button id="cancelSaveBtn"><i class="fas fa-times"></i> Отмена</button>
                <button id="confirmSaveBtn"><i class="fas fa-check"></i> Сохранить</button>
            </div>
        </div>
    </div>
    
    <!-- Reset modal -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Подтверждение сброса</h3>
            </div>
            <div class="modal-body">
                <p>Вы уверены, что хотите сбросить все данные текущей смены?</p>
            </div>
            <div class="modal-footer">
                <button id="cancelResetBtn"><i class="fas fa-times"></i> Отмена</button>
                <button id="confirmResetBtn"><i class="fas fa-redo"></i> Сбросить</button>
            </div>
        </div>
    </div>
    
    <!-- Edit archive modal -->
    <div id="editArchiveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Редактирование смены</h3>
            </div>
            <div class="modal-body">
                <p>Введите новое название:</p>
                <input type="text" id="editShiftName" placeholder="Новое название смены">
            </div>
            <div class="modal-footer">
                <button id="cancelEditBtn"><i class="fas fa-times"></i> Отмена</button>
                <button id="saveEditBtn"><i class="fas fa-check"></i> Сохранить</button>
            </div>
        </div>
    </div>

    <!-- Excel export library -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <script>
        // App data
        const employees = [
            "Ануров Роман", "Ивановская Екатерина", "Барчий Василий", "Власенко Дмитрий", 
            "Горявский Дмитрий", "Курбатов Валерий", "Курочкин Артём", "Курочкина Ксения", 
            "Солодянкин Антон", "Черепов Владислав", "Заворина Анастасия", "Зотов Максим", 
            "Епифанов Дмитрий", "Тарасова Юлия", "Савитская Оксана", "Варламова Ксения", 
            "Алексеев Андрей", "Петрова Александра"
        ];
        
        const sections = [
            "RUWI", "РАЗМЕЩЕНИЕ", 
            "Возвраты (джокер)", "Певричка (джокер)", "Нулевая комната",
            "МВ (поиск потерянного товара)", "Джокер NC",
            "Поиск Missing_Putaway", "FWO", "Поиск Missing_Picking", 
            "TS в отделе QA", "RQMI и 0052", "Not_found", "Тех. Локи",
        ];
        
        // App state
        let state = {
            available: [...employees],
            vacation: [],
            sickLeave: [],
            dayOff: [],
            assignments: {},
            archive: JSON.parse(localStorage.getItem('shiftArchive')) || []
        };
        
        // Initialize interface
        function initInterface() {
            initSectionsPanel();
            initStaffTabs();
            updateStaffPanels();
            updateCounters();
            setupDropzones();
            setupMobileMenu();
        }
        
        // Initialize sections panel
        function initSectionsPanel() {
            const panel = document.getElementById('sectionsPanel');
            panel.innerHTML = '';
            
            sections.forEach(section => {
                state.assignments[section] = state.assignments[section] || [];
                
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card';
                sectionCard.innerHTML = `
                    <div class="section-header">
                        <span>${section}</span>
                        <span class="section-counter">${state.assignments[section].length}</span>
                    </div>
                    <div class="section-content dropzone" data-section="${section}" id="section-${section.replace(/\s+/g, '-')}"></div>
                `;
                
                panel.appendChild(sectionCard);
                updateSectionEmployees(section);
            });
        }
        
        // Update employees in section
        function updateSectionEmployees(section) {
            const container = document.querySelector(`#section-${section.replace(/\s+/g, '-')}`);
            container.innerHTML = '';
            
            state.assignments[section].forEach(employee => {
                const empElement = createEmployeeElement(employee, section);
                container.appendChild(empElement);
            });
            
            // Update counter
            const counter = container.closest('.section-card').querySelector('.section-counter');
            counter.textContent = state.assignments[section].length;
            
            updateTotalCounters();
        }
        
        // Initialize staff tabs
        function initStaffTabs() {
            document.querySelectorAll('.staff-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Deactivate all tabs
                    document.querySelectorAll('.staff-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.staff-content').forEach(c => c.classList.remove('active'));
                    
                    // Activate current
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}Staff`).classList.add('active');
                });
            });
        }
        
        // Update staff panels
        function updateStaffPanels() {
            updateStaffPanel('available');
            updateStaffPanel('vacation');
            updateStaffPanel('sickLeave');
            updateStaffPanel('dayOff');
            updateCounters();
        }
        
        function updateStaffPanel(type) {
            const container = document.querySelector(`#${type}Staff .staff-grid`);
            container.innerHTML = '';
            
            state[type].forEach(employee => {
                const empElement = createEmployeeElement(employee, type);
                container.appendChild(empElement);
            });
        }
        
        // Create employee element
        function createEmployeeElement(employee, source) {
            const card = document.createElement('div');
            card.className = 'employee-card';
            card.draggable = true;
            card.dataset.employee = employee;
            card.dataset.source = source;
            
            // Generate avatar from initials
            const initials = employee.split(' ').map(n => n[0]).join('');
            
            card.innerHTML = `
                <div class="employee-avatar">${initials}</div>
                <div class="employee-name">${employee}</div>
                <div class="employee-status ${source === 'available' ? 'available' : ''}"></div>
            `;
            
            card.addEventListener('dragstart', dragStart);
            return card;
        }
        
        // Drag and drop functionality
        function dragStart(e) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
                employee: e.target.dataset.employee,
                source: e.target.dataset.source
            }));
            e.dataTransfer.effectAllowed = 'move';
        }
        
        function setupDropzones() {
            const dropzones = document.querySelectorAll('.dropzone');
            
            dropzones.forEach(zone => {
                zone.addEventListener('dragover', e => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('highlight');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('highlight');
                });
                
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('highlight');
                    
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const employee = data.employee;
                    const source = data.source;
                    const target = zone.id === 'availableStaff' ? 'available' : 
                                   zone.id === 'vacationStaff' ? 'vacation' :
                                   zone.id === 'sickLeaveStaff' ? 'sickLeave' :
                                   zone.id === 'dayOffStaff' ? 'dayOff' : 
                                   zone.dataset.section;
                    
                    moveEmployee(employee, source, target);
                });
            });
        }
        
        // Move employee between sections
        function moveEmployee(employee, source, target) {
            if (source === target) return;
            
            removeEmployeeFromSource(employee, source);
            
            if (!addEmployeeToTarget(employee, target)) {
                addEmployeeToTarget(employee, source);
                return;
            }
            
            updateUIAfterMove(employee, source, target);
            showToast(`Сотрудник перемещен в ${getTargetName(target)}`, 'success');
        }
        
        function getTargetName(target) {
            const names = {
                'available': 'Доступные',
                'vacation': 'Отпуск',
                'sickLeave': 'Больничный',
                'dayOff': 'Отгул'
            };
            return names[target] || target;
        }
        
        function removeEmployeeFromSource(employee, source) {
            if (source === 'available') {
                state.available = state.available.filter(e => e !== employee);
            } else if (source === 'vacation') {
                state.vacation = state.vacation.filter(e => e !== employee);
            } else if (source === 'sickLeave') {
                state.sickLeave = state.sickLeave.filter(e => e !== employee);
            } else if (source === 'dayOff') {
                state.dayOff = state.dayOff.filter(e => e !== employee);
            } else if (state.assignments[source]) {
                state.assignments[source] = state.assignments[source].filter(e => e !== employee);
            }
        }
        
        function addEmployeeToTarget(employee, target) {
            if (target === 'available') {
                if (!state.available.includes(employee)) {
                    state.available.push(employee);
                    return true;
                }
            } else if (target === 'vacation') {
                if (!state.vacation.includes(employee)) {
                    state.vacation.push(employee);
                    return true;
                }
            } else if (target === 'sickLeave') {
                if (!state.sickLeave.includes(employee)) {
                    state.sickLeave.push(employee);
                    return true;
                }
            } else if (target === 'dayOff') {
                if (!state.dayOff.includes(employee)) {
                    state.dayOff.push(employee);
                    return true;
                }
            } else if (state.assignments[target]) {
                const isAlreadyAssigned = Object.entries(state.assignments)
                    .filter(([section, _]) => section !== target)
                    .some(([_, employees]) => employees.includes(employee));
                
                if (!isAlreadyAssigned && !state.assignments[target].includes(employee)) {
                    state.assignments[target].push(employee);
                    return true;
                } else if (isAlreadyAssigned) {
                    showToast('Сотрудник уже назначен на другой участок!', 'error');
                    return false;
                }
            }
            return true;
        }
        
        function updateUIAfterMove(employee, source, target) {
            if (source === 'available' || target === 'available') {
                updateStaffPanel('available');
            }
            
            if (source === 'vacation' || target === 'vacation') {
                updateStaffPanel('vacation');
            }
            
            if (source === 'sickLeave' || target === 'sickLeave') {
                updateStaffPanel('sickLeave');
            }
            
            if (source === 'dayOff' || target === 'dayOff') {
                updateStaffPanel('dayOff');
            }
            
            if (state.assignments[source]) {
                updateSectionEmployees(source);
            }
            
            if (state.assignments[target]) {
                updateSectionEmployees(target);
            }
            
            updateCounters();
        }
        
        // Update counters
        function updateCounters() {
            document.getElementById('availableCounter').textContent = state.available.length;
            document.getElementById('vacationCounter').textContent = state.vacation.length;
            document.getElementById('sickLeaveCounter').textContent = state.sickLeave.length;
            document.getElementById('dayOffCounter').textContent = state.dayOff.length;
            
            updateTotalCounters();
        }
        
        function updateTotalCounters() {
            const totalAssigned = Object.values(state.assignments).reduce((sum, employees) => sum + employees.length, 0);
            const unavailable = state.vacation.length + state.sickLeave.length + state.dayOff.length;
            const totalAvailable = employees.length - unavailable;
            
            document.getElementById('totalAssignedCounter').textContent = totalAssigned;
            document.getElementById('totalAvailableCounter').textContent = totalAvailable;
        }
        
        // Reset all data
        function resetAll() {
            state = {
                available: [...employees],
                vacation: [],
                sickLeave: [],
                dayOff: [],
                assignments: {},
                archive: state.archive
            };
            
            initInterface();
            showToast('Все данные сброшены', 'info');
        }
        
        // Save to archive
        function saveToArchive(name) {
            if (!name.trim()) {
                showToast('Пожалуйста, введите название смены', 'error');
                return;
            }
            
            const shiftData = {
                name: name.trim(),
                date: new Date().toLocaleString(),
                data: {
                    available: [...state.available],
                    vacation: [...state.vacation],
                    sickLeave: [...state.sickLeave],
                    dayOff: [...state.dayOff],
                    assignments: JSON.parse(JSON.stringify(state.assignments))
                }
            };
            
            state.archive.push(shiftData);
            localStorage.setItem('shiftArchive', JSON.stringify(state.archive));
            document.getElementById('shiftName').value = '';
            document.getElementById('saveModal').style.display = 'none';
            showToast('Смена сохранена в архив', 'success');
        }
        
        // Load from archive
        function loadFromArchive(index) {
            const shiftData = state.archive[index];
            state.available = [...shiftData.data.available];
            state.vacation = [...shiftData.data.vacation];
            state.sickLeave = [...shiftData.data.sickLeave];
            state.dayOff = [...shiftData.data.dayOff];
            state.assignments = JSON.parse(JSON.stringify(shiftData.data.assignments));
            
            initInterface();
            document.getElementById('archiveModal').style.display = 'none';
            showToast(`Загружена смена "${shiftData.name}"`, 'success');
        }
        
        // Delete from archive
        function deleteFromArchive(index) {
            state.archive.splice(index, 1);
            localStorage.setItem('shiftArchive', JSON.stringify(state.archive));
            showArchive();
            showToast('Запись удалена из архива', 'info');
        }
        
        // Edit archive item
        function editArchiveItem(index, newName) {
            if (!newName.trim()) {
                showToast('Пожалуйста, введите название смены', 'error');
                return;
            }
            
            state.archive[index].name = newName.trim();
            localStorage.setItem('shiftArchive', JSON.stringify(state.archive));
            document.getElementById('editArchiveModal').style.display = 'none';
            showArchive();
            showToast('Название смены изменено', 'success');
        }
        
        // Show archive
        function showArchive() {
            const archiveList = document.getElementById('archiveList');
            archiveList.innerHTML = '';
            
            if (state.archive.length === 0) {
                archiveList.innerHTML = '<p style="text-align: center; color: #777;">Архив пуст</p>';
            } else {
                state.archive.forEach((item, index) => {
                    const archiveItem = document.createElement('div');
                    archiveItem.className = 'archive-item';
                    archiveItem.innerHTML = `
                        <div class="archive-info">
                            <div class="archive-name">${item.name}</div>
                            <div class="archive-date">${item.date}</div>
                        </div>
                        <div class="archive-actions">
                            <button data-index="${index}" class="load-archive-btn"><i class="fas fa-download"></i></button>
                            <button data-index="${index}" class="edit-archive-btn"><i class="fas fa-edit"></i></button>
                            <button data-index="${index}" class="delete-archive-btn"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    archiveList.appendChild(archiveItem);
                });
            }
            
            document.getElementById('archiveModal').style.display = 'block';
        }

        // Export to Excel
        function exportToExcel() {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Prepare assignment data
            const assignmentData = [["Участок", "Сотрудники"]];
            
            sections.forEach(section => {
                const employees = state.assignments[section] || [];
                assignmentData.push([section, employees.join(", ")]);
            });
            
            // Create worksheet
            const assignmentWs = XLSX.utils.aoa_to_sheet(assignmentData);
            XLSX.utils.book_append_sheet(wb, assignmentWs, "Расстановка");
            
            // Prepare status data
            const statusData = [
                ["Статус", "Сотрудники"],
                ["Доступные", state.available.join(", ")],
                ["Отпуск", state.vacation.join(", ")],
                ["Больничный", state.sickLeave.join(", ")],
                ["Отгул", state.dayOff.join(", ")]
            ];
            
            // Create worksheet
            const statusWs = XLSX.utils.aoa_to_sheet(statusData);
            XLSX.utils.book_append_sheet(wb, statusWs, "Статусы");
            
            // Generate filename with current date
            const date = new Date();
            const fileName = `Расстановка_Lamoda_${date.getDate()}-${date.getMonth()+1}-${date.getFullYear()}.xlsx`;
            
            // Save file
            XLSX.writeFile(wb, fileName);
            showToast('Данные экспортированы в Excel', 'success');
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            const icon = type === 'success' ? 'check-circle' : 
                         type === 'error' ? 'exclamation-circle' : 'info-circle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                ${message}
            `;
            
            document.body.appendChild(toast);
            
            // Animation
            toast.style.animation = 'slideIn 0.3s, fadeOut 0.5s 2.5s forwards';
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Initialize modals
        function initModals() {
            // Archive modal
            document.getElementById('archiveBtn').addEventListener('click', showArchive);
            document.getElementById('closeArchiveBtn').addEventListener('click', () => {
                document.getElementById('archiveModal').style.display = 'none';
            });
            
            // Save modal
            document.getElementById('saveBtn').addEventListener('click', () => {
                document.getElementById('saveModal').style.display = 'block';
                document.getElementById('shiftName').focus();
            });
            
            document.getElementById('cancelSaveBtn').addEventListener('click', () => {
                document.getElementById('saveModal').style.display = 'none';
            });
            
            document.getElementById('confirmSaveBtn').addEventListener('click', () => {
                saveToArchive(document.getElementById('shiftName').value);
            });
            
            // Reset modal
            document.getElementById('resetBtn').addEventListener('click', () => {
                document.getElementById('resetModal').style.display = 'block';
            });
            
            document.getElementById('cancelResetBtn').addEventListener('click', () => {
                document.getElementById('resetModal').style.display = 'none';
            });
            
            document.getElementById('confirmResetBtn').addEventListener('click', () => {
                resetAll();
                document.getElementById('resetModal').style.display = 'none';
            });
            
            // Edit archive modal
            document.getElementById('cancelEditBtn').addEventListener('click', () => {
                document.getElementById('editArchiveModal').style.display = 'none';
            });
            
            document.getElementById('saveEditBtn').addEventListener('click', () => {
                const index = document.getElementById('editArchiveModal').dataset.index;
                editArchiveItem(index, document.getElementById('editShiftName').value);
            });
            
            // Export to Excel
            document.getElementById('exportBtn').addEventListener('click', exportToExcel);
            
            // Archive item actions
            document.addEventListener('click', (e) => {
                if (e.target.closest('.load-archive-btn')) {
                    const btn = e.target.closest('.load-archive-btn');
                    loadFromArchive(parseInt(btn.dataset.index));
                } else if (e.target.closest('.edit-archive-btn')) {
                    const btn = e.target.closest('.edit-archive-btn');
                    const index = parseInt(btn.dataset.index);
                    document.getElementById('editShiftName').value = state.archive[index].name;
                    document.getElementById('editArchiveModal').dataset.index = index;
                    document.getElementById('editArchiveModal').style.display = 'block';
                } else if (e.target.closest('.delete-archive-btn')) {
                    const btn = e.target.closest('.delete-archive-btn');
                    if (confirm('Вы уверены, что хотите удалить эту запись?')) {
                        deleteFromArchive(parseInt(btn.dataset.index));
                    }
                }
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
        }
        
        // Setup mobile menu
        function setupMobileMenu() {
            const menuBtn = document.querySelector('.mobile-menu-btn');
            const headerControls = document.querySelector('.header-controls');
            
            if (menuBtn && headerControls) {
                menuBtn.addEventListener('click', function() {
                    headerControls.classList.toggle('active');
                });
                
                // Close menu when clicking on item
                document.querySelectorAll('.header-controls button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        headerControls.classList.remove('active');
                    });
                });
            }
        }
        
        // Initialize app
        function init() {
            initInterface();
            initModals();
        }
        
        window.onload = init;
    </script>
</body>
</html>