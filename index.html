<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lamoda TS — Умная расстановка персонала</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --red: #E31E24;
            --black: #1A1A1A;
            --white: #FFFFFF;
            --gray-100: #F8F9FA;
            --gray-200: #E9ECEF;
            --gray-500: #6C757D;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--gray-100);
            color: var(--black);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Хедер */
        .header {
            background-color: var(--black);
            color: var(--white);
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 100;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
            flex: 1;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .counter {
            background-color: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn {
            background-color: var(--red);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .btn:hover {
            background-color: #C00;
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn i {
            font-size: 14px;
        }

        /* Основной контент */
        .main-content {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
        }

        /* Таблица участков */
        .assignment-section {
            flex: 2;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            min-width: 0;
        }

        .section-header {
            padding: 16px 20px;
            background-color: var(--black);
            color: white;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-container {
            flex: 1;
            overflow: auto;
            padding: 0;
        }

        .assignment-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 500px;
        }

        .assignment-table th {
            position: sticky;
            top: 0;
            background-color: var(--gray-100);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-500);
            padding: 12px 16px;
            border-bottom: 1px solid var(--gray-200);
            z-index: 10;
        }

        .assignment-table td {
            padding: 0;
            vertical-align: top;
            border-bottom: 1px solid var(--gray-200);
            height: 60px; /* Фиксированная высота строк */
        }

        .section-cell {
            padding: 12px 16px;
            font-weight: 500;
            width: 35%;
            position: sticky;
            left: 0;
            background: white;
            border-right: 1px solid var(--gray-200);
        }

        .employees-cell {
            padding: 8px;
            width: 65%;
        }

        .employees-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            min-height: 44px; /* Минимальная высота даже для пустых ячеек */
        }

        /* Карточки сотрудников */
        .employee-card {
            background-color: white;
            border: 1px solid var(--gray-200);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: grab;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .employee-card:hover {
            background-color: #FFF0F0;
            border-color: #FFD6D6;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .employee-card:active {
            cursor: grabbing;
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--gray-500);
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }

        .delete-btn:hover {
            background-color: rgba(227, 30, 36, 0.1);
            color: var(--red);
        }

        /* Боковая панель с сотрудниками */
        .staff-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 320px;
            max-width: 380px;
        }

        .staff-group {
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 200px;
        }

        .dropzone {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .dropzone.highlight {
            background-color: rgba(227, 30, 36, 0.05);
            outline: 2px dashed rgba(227, 30, 36, 0.3);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .employee-card {
            animation: fadeIn 0.3s ease-out;
        }

        /* Адаптивность */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .staff-section {
                max-width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .staff-group {
                min-width: calc(50% - 8px);
                flex: 1 1 auto;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-wrap: wrap;
                gap: 12px;
                padding: 12px 16px;
            }
            
            .header-title {
                order: 1;
                flex: 1 1 100%;
                justify-content: center;
            }
            
            .header-controls {
                order: 2;
                flex: 1;
                justify-content: center;
            }
            
            .main-content {
                padding: 16px;
                gap: 16px;
            }
            
            .section-cell {
                width: 40%;
            }
            
            .employees-cell {
                width: 60%;
            }
        }

        @media (max-width: 480px) {
            .btn span {
                display: none;
            }
            
            .btn i {
                margin-right: 0;
            }
            
            .staff-group {
                min-width: 100%;
            }
            
            .employee-card {
                font-size: 12px;
                padding: 5px 10px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1 class="header-title">
            <i class="fas fa-users-cog"></i>
            <span>Умная расстановка персонала | Lamoda TS</span>
        </h1>
        <div class="header-controls">
            <div class="counter">
                <i class="fas fa-user-check"></i>
                <span id="totalAssignedCounter">0</span>/<span id="totalAvailableCounter">0</span>
            </div>
            <button class="btn" id="archiveBtn">
                <i class="fas fa-archive"></i>
                <span>Архив</span>
            </button>
            <button class="btn" id="exportBtn">
                <i class="fas fa-file-excel"></i>
                <span>Экспорт</span>
            </button>
            <button class="btn" id="saveBtn">
                <i class="fas fa-save"></i>
                <span>Сохранить</span>
            </button>
            <button class="btn" id="resetBtn">
                <i class="fas fa-redo"></i>
                <span>Сбросить</span>
            </button>
        </div>
    </header>
    
    <main class="main-content">
        <section class="assignment-section">
            <div class="section-header">
                <i class="fas fa-map-marked-alt"></i>
                <span>Текущая расстановка</span>
            </div>
            <div class="table-container">
                <table class="assignment-table">
                    <thead>
                        <tr>
                            <th>Участок</th>
                            <th>Сотрудники</th>
                        </tr>
                    </thead>
                    <tbody id="assignmentBody">
                        <!-- Строки будут добавлены через JS -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <section class="staff-section">
            <div class="staff-group">
                <div class="section-header">
                    <i class="fas fa-user-clock"></i>
                    <span>Доступные</span>
                    <span class="counter" id="availableCounter">0</span>
                </div>
                <div id="availableStaff" class="dropzone"></div>
            </div>
            
            <div class="staff-group">
                <div class="section-header">
                    <i class="fas fa-umbrella-beach"></i>
                    <span>Отпуск</span>
                    <span class="counter" id="vacationCounter">0</span>
                </div>
                <div id="vacationStaff" class="dropzone"></div>
            </div>
            
            <div class="staff-group">
                <div class="section-header">
                    <i class="fas fa-procedures"></i>
                    <span>Больничный</span>
                    <span class="counter" id="sickLeaveCounter">0</span>
                </div>
                <div id="sickLeaveStaff" class="dropzone"></div>
            </div>
            
            <div class="staff-group">
                <div class="section-header">
                    <i class="far fa-calendar-minus"></i>
                    <span>Отгул</span>
                    <span class="counter" id="dayOffCounter">0</span>
                </div>
                <div id="dayOffStaff" class="dropzone"></div>
            </div>
        </section>
    </main>

    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <script>
        // Данные приложения
        const employees = [
            "Ануров Роман", "Ивановская Екатерина", "Барчий Василий", 
            "Власенко Дмитрий", "Горявский Дмитрий", "Курбатов Валерий", 
            "Курочкин Артём", "Курочкина Ксения", "Солодянкин Антон", 
            "Черепов Владислав", "Заворина Анастасия", "Зотов Максим",
            "Епифанов Дмитрий", "Тарасова Юлия", "Савитская Оксана", 
            "Варламова Ксения", "Алексеев Андрей", "Петрова Александра"
        ];
        
        const sections = [
            "RUWI", "РАЗМЕЩЕНИЕ", "Возвраты (джокер)", 
            "Певричка (джокер)", "Нулевая комната", "МВ (поиск потерянного товара)", 
            "Джокер NC", "Поиск Missing_Putaway", "FWO", "Поиск Missing_Picking", 
            "TS в отделе QA", "RQMI и 0052", "Not_found", "Тех. Локи"
        ];
        
        // Состояние приложения
        const state = {
            available: [...employees],
            vacation: [],
            sickLeave: [],
            dayOff: [],
            assignments: {},
            archive: JSON.parse(localStorage.getItem('lamodaShiftArchive')) || []
        };
        
        // Инициализация таблицы
        function initAssignmentTable() {
            const tbody = document.getElementById('assignmentBody');
            tbody.innerHTML = '';
            
            sections.forEach(section => {
                state.assignments[section] = state.assignments[section] || [];
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="section-cell">${section}</td>
                    <td class="employees-cell dropzone" data-section="${section}">
                        <div class="employees-container"></div>
                    </td>
                `;
                tbody.appendChild(row);
                
                updateSectionEmployees(section);
            });
        }
        
        // Обновление списка сотрудников на участке
        function updateSectionEmployees(section) {
            const container = document.querySelector(`td[data-section="${section}"] .employees-container`);
            if (!container) return;
            
            container.innerHTML = '';
            
            state.assignments[section].forEach(employee => {
                container.appendChild(createEmployeeCard(employee, section));
            });
            
            // Добавляем невидимый элемент для сохранения высоты
            if (state.assignments[section].length === 0) {
                const spacer = document.createElement('div');
                spacer.style.visibility = 'hidden';
                spacer.style.height = '30px';
                spacer.innerHTML = '&nbsp;';
                container.appendChild(spacer);
            }
        }
        
        // Создание карточки сотрудника
        function createEmployeeCard(employee, source) {
            const card = document.createElement('div');
            card.className = 'employee-card';
            card.textContent = employee;
            card.draggable = true;
            card.dataset.employee = employee;
            card.dataset.source = source;
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '&times;';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                removeEmployee(employee, source);
                showToast('Сотрудник удален');
            };
            
            card.appendChild(deleteBtn);
            card.addEventListener('dragstart', handleDragStart);
            
            return card;
        }
        
        // Инициализация списков сотрудников
        function initStaffLists() {
            initStaffList('available', 'availableStaff');
            initStaffList('vacation', 'vacationStaff');
            initStaffList('sickLeave', 'sickLeaveStaff');
            initStaffList('dayOff', 'dayOffStaff');
        }
        
        function initStaffList(stateKey, elementId) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            state[stateKey].forEach(employee => {
                container.appendChild(createEmployeeCard(employee, stateKey));
            });
            
            updateCounters();
        }
        
        // Drag and Drop
        function handleDragStart(e) {
            e.dataTransfer.setData('application/json', JSON.stringify({
                employee: e.target.dataset.employee,
                source: e.target.dataset.source
            }));
            e.dataTransfer.effectAllowed = 'move';
        }
        
        function setupDropzones() {
            document.querySelectorAll('.dropzone').forEach(zone => {
                zone.addEventListener('dragover', e => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('highlight');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('highlight');
                });
                
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('highlight');
                    
                    const data = JSON.parse(e.dataTransfer.getData('application/json'));
                    const { employee, source } = data;
                    const target = getDropzoneTarget(zone);
                    
                    if (source !== target) {
                        moveEmployee(employee, source, target);
                    }
                });
            });
        }
        
        function getDropzoneTarget(zone) {
            switch(zone.id) {
                case 'availableStaff': return 'available';
                case 'vacationStaff': return 'vacation';
                case 'sickLeaveStaff': return 'sickLeave';
                case 'dayOffStaff': return 'dayOff';
                default: return zone.dataset.section;
            }
        }
        
        // Перемещение сотрудника
        function moveEmployee(employee, source, target) {
            if (removeFromSource(employee, source)) {
                if (addToTarget(employee, target)) {
                    updateUI(source, target);
                    updateCounters();
                    showToast(`Сотрудник перемещен: ${getTargetName(target)}`);
                } else {
                    addToTarget(employee, source); // Возвращаем обратно, если не удалось добавить
                }
            }
        }
        
        function removeFromSource(employee, source) {
            if (source === 'available') {
                state.available = state.available.filter(e => e !== employee);
                return true;
            } else if (source === 'vacation') {
                state.vacation = state.vacation.filter(e => e !== employee);
                return true;
            } else if (source === 'sickLeave') {
                state.sickLeave = state.sickLeave.filter(e => e !== employee);
                return true;
            } else if (source === 'dayOff') {
                state.dayOff = state.dayOff.filter(e => e !== employee);
                return true;
            } else if (state.assignments[source]) {
                state.assignments[source] = state.assignments[source].filter(e => e !== employee);
                return true;
            }
            return false;
        }
        
        function addToTarget(employee, target) {
            if (target === 'available') {
                if (!state.available.includes(employee)) {
                    state.available.push(employee);
                    return true;
                }
            } else if (target === 'vacation') {
                if (!state.vacation.includes(employee)) {
                    state.vacation.push(employee);
                    return true;
                }
            } else if (target === 'sickLeave') {
                if (!state.sickLeave.includes(employee)) {
                    state.sickLeave.push(employee);
                    return true;
                }
            } else if (target === 'dayOff') {
                if (!state.dayOff.includes(employee)) {
                    state.dayOff.push(employee);
                    return true;
                }
            } else if (state.assignments[target]) {
                const isAssignedElsewhere = Object.entries(state.assignments)
                    .filter(([section]) => section !== target)
                    .some(([_, employees]) => employees.includes(employee));
                
                if (!isAssignedElsewhere) {
                    state.assignments[target].push(employee);
                    return true;
                } else {
                    showToast('Ошибка: сотрудник уже назначен на другой участок', 'error');
                    return false;
                }
            }
            return true;
        }
        
        function updateUI(source, target) {
            if (source === 'available' || target === 'available') {
                initStaffList('available', 'availableStaff');
            }
            
            if (source === 'vacation' || target === 'vacation') {
                initStaffList('vacation', 'vacationStaff');
            }
            
            if (source === 'sickLeave' || target === 'sickLeave') {
                initStaffList('sickLeave', 'sickLeaveStaff');
            }
            
            if (source === 'dayOff' || target === 'dayOff') {
                initStaffList('dayOff', 'dayOffStaff');
            }
            
            if (state.assignments[source]) {
                updateSectionEmployees(source);
            }
            
            if (state.assignments[target]) {
                updateSectionEmployees(target);
            }
        }
        
        function getTargetName(target) {
            const names = {
                'available': 'Доступные',
                'vacation': 'Отпуск',
                'sickLeave': 'Больничный',
                'dayOff': 'Отгул'
            };
            return names[target] || target;
        }
        
        // Обновление счетчиков
        function updateCounters() {
            document.getElementById('availableCounter').textContent = state.available.length;
            document.getElementById('vacationCounter').textContent = state.vacation.length;
            document.getElementById('sickLeaveCounter').textContent = state.sickLeave.length;
            document.getElementById('dayOffCounter').textContent = state.dayOff.length;
            
            // Общий счетчик
            const totalAssigned = Object.values(state.assignments).reduce((sum, arr) => sum + arr.length, 0);
            const totalUnavailable = state.vacation.length + state.sickLeave.length + state.dayOff.length;
            const totalAvailable = employees.length - totalUnavailable;
            
            document.getElementById('totalAssignedCounter').textContent = totalAssigned;
            document.getElementById('totalAvailableCounter').textContent = totalAvailable;
        }
        
        // Уведомления
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Инициализация приложения
        function init() {
            initAssignmentTable();
            initStaffLists();
            setupDropzones();
            updateCounters();
            
            // Здесь можно добавить обработчики для кнопок
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (confirm('Сбросить все назначения?')) {
                    resetState();
                    showToast('Все назначения сброшены');
                }
            });
        }
        
        function resetState() {
            state.available = [...employees];
            state.vacation = [];
            state.sickLeave = [];
            state.dayOff = [];
            state.assignments = {};
            
            initAssignmentTable();
            initStaffLists();
            updateCounters();
        }
        
        // Запуск приложения
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
